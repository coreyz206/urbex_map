<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <input type="file" id="file-input" >
    <div id="file-content"></div>
    <div id="map"></div>
    <script>
      function readSingleFile(e) {
        var file = e.target.files[0];
        if (!file) {
          return;
        }
        var reader = new FileReader();
        reader.readAsText(file);
        reader.onload = function(e) {
          var contents = e.target.result;
          initMap(contents);
        }
      };

      // Basic map initialization
      var map;
      function initMap(placeRaw) {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 47.5, lng: -122},
          zoom: 9
        });
        placeData = JSON.parse(placeRaw)
        var markers = [];
        var descriptionWindows = [];
        var descriptionContent = [];
        var nameWindows = [];
        var nameContent = [];
        for(i in placeData){
          markers[i] = new google.maps.Marker({
            position: {lat: placeData[i]["X Coord"],
                        lng: placeData[i]["Y Coord"]},
            map: map,
            title: placeData[i]["Name"]
          });

          nameContent[i] = '<div id="title"> <b>' + placeData[i]["Name"] + '</b> </div>';
          descriptionContent[i] = '<div id="content">' + placeData[i]["Description"] + '</div>';

          descriptionWindows[i] = new google.maps.InfoWindow({
            content: descriptionContent[i],
            maxWidth: 500
          });

          nameWindows[i] = new google.maps.InfoWindow({
            content: nameContent[i],
            maxWidth: 300
          });

          function clickListener(i) {
            return function() {
              nameWindows[i].close(map, markers[i]);
              descriptionWindows[i].open(map, markers[i])
            }
          };

          function enterListener(i) {
            return function() {
              nameWindows[i].open(map, markers[i])
            }
          };

          function leaveListener(i) {
            return function() {
              nameWindows[i].close(map, markers[i])
            }
          };

          markers[i].addListener('click', clickListener(i));
          markers[i].addListener('mouseover', enterListener(i));
          markers[i].addListener('mouseout', leaveListener(i))
        }
      }

      document.getElementById('file-input').addEventListener('change', readSingleFile, false);
    </script>
    <!--
    TODO

    Right now the listener only opens the last location object.
    I have no idea how to fix this. It did the same thing when I used global variables.
    It's like you can only have one listener or something, weird.

    Once all this is done, Kevin should be done with the API. Then you can get rid of
    all this BuLlShIt and just take the data in ezpz json form directly from the API call.

    Hell, once the API is working I can probably just throw the get call right in initMap.
    -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDvx71KQmfMXV17yo-Ewl0-QRX8kvNhNdI"
    async defer></script>
  </body>
</html>